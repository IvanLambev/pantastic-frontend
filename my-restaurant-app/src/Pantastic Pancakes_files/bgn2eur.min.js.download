class Bgn2EurCurrencyConverter{constructor(){this.installCss(),this.config=this.initializeConfig(),this.cache=new Map,this.observers=new Set,this.mapping={cart:".bgn2eur-convertion-message-cart",checkout:".bgn2eur-convertion-message-checkout",footer:".bgn2eur-convertion-message-footer"},this.displayMessage()}getMessage(){return 5.7===window.APP_VERSION?window.cc_settings?.bgn2eur_conversion_message:window.CCAppsConfig?.bgn2eur?.message||null}displayMessage(){var e=this.getMessage();if(e){let r={cart:`<p><small>${e}</small></p>`,checkout:`<p>${e}</p>`,footer:`<p>${e}</p>`};window.addEventListener("dataLayer:push",()=>{for(var e in this.mapping){if(!window.CCAppsConfig?.bgn2eur?.[e])return;var t=this.mapping[e];$(t).removeClass("hidden").html(r[e])}})}}initializeConfig(){var e,t=window?.ccsettings?.currency||{};let r="BGN"===t.code;return window?.ccsettings?.currency&&void 0!==t.code&&null!==t.code||(e=document.querySelector(".bgn2eur-primary-currency"))&&((e=e.textContent.toLowerCase()).includes("bgn")||e.includes("лв.")||e.includes("лв"))&&(r=!0),{rate:r?.511292:1/.511292,isBGN:r,thousandsSep:t.thousands_sep||" ",decPoint:t.dec_point||",",signLeft:this.getSignLeft(t,r),signRight:this.getSignRight(t,r),locale:" "===this.thousandsSep?"bg-BG":"en-GB",selectors:{primary:".bgn2eur-primary-currency",secondary:".bgn2eur-secondary-currency",priceElements:[".product-details-js ._product-details-price-new .bgn2eur-primary-currency",".product-details-js ._product-details-price-value .bgn2eur-primary-currency",".product-details-js ._product-details-price-old>i .bgn2eur-primary-currency",".price-new-js .bgn2eur-primary-currency",".price-old-js .bgn2eur-primary-currency",".js-discount-save-price .bgn2eur-primary-currency"],unitElements:"._button_unit_inner"}}}getSignLeft(e,t){return t?e.sign_left?.trim()?"€ ":"":e.sign_left?.trim()?"BGN ":""}getSignRight(e,t){return t?e.sign_right?.trim()?" €":"":e.sign_right?.trim()?" лв.":""}hasSecondaryPrice(e){return e.parentNode?.querySelector(this.config.selectors.secondary)}parsePrice(e){var t=e.textContent;return this.cache.has(t)?this.cache.get(t):(e=this.extractPriceData(e),this.cache.set(t,e),e)}extractPriceData(e){let t=Array.from(e.childNodes).filter(e=>!(e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("_product-details-meta")||(e.nodeType===Node.TEXT_NODE&&e.parentElement&&e.parentElement.classList.contains("_product-details-meta")||e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("price-decimals")))).map(e=>e.textContent).join("").replace(/[\s\u00A0]/g,"");t=t.replace(/(лв\.?|BGN)/gi,"").replace(/[^\d.,]/g,"");var r,n=window?.ccsettings?.currency?.dec_point||",",e=(window?.ccsettings?.currency?.thousands_sep,e.querySelector(".price-decimals"));if(e)return r=(r=t.match(/(\d[\d.,]*)/))?r[1].replace(/[.,]/g,""):"",e=e.innerText.replace(/\D/g,"")||"00",{price:parseFloat(r+"."+e),decimals:e};let c=NaN;return{price:c=","===n?/^\d{1,3}(?:\.\d{3})*,\d{2}$/.test(t)?parseFloat(t.replace(/\./g,"").replace(",",".")):t.includes(",")?parseFloat(t.replace(",",".")):parseFloat(t):/^\d{1,3}(?:,\d{3})*\.\d{2}$/.test(t)?parseFloat(t.replace(/,/g,"")):(t.includes("."),parseFloat(t)),decimals:"00"}}formatPrice(e){var t=window?.ccsettings?.currency?.dec_point||",",r=window?.ccsettings?.currency?.thousands_sep||" ";return e.toLocaleString((" "!==r||","!==t)&&","===r&&"."===t?"en-US":"bg-BG",{minimumFractionDigits:2,maximumFractionDigits:2})}createSecondaryElement(i,s){var e=document.createElement(i.tagName),s=(e.className=this.config.selectors.secondary.slice(1),this.formatPrice(s)),o=!!i.querySelector(".price-decimals"),a=window?.ccsettings?.currency?.dec_point||",";let d="";d=o?([o,l]=s.split(a),""+this.config.signLeft+o+a+`<sup class="price-decimals">${l}</sup>${this.config.signRight}&nbsp;`):""+this.config.signLeft+s+this.config.signRight+"&nbsp;";o=i.querySelector("._product-details-meta");if(o){let r=0,n="",c="";if(o.childNodes.forEach(e=>{var t;e.nodeType===Node.TEXT_NODE&&(t=e.textContent.match(/([\d.,]+)/))&&(n=t[1].replace(/[.,]/g,"")),e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("price-decimals")&&(c=e.textContent.replace(/\D/g,"")||"00")}),n&&(r=parseFloat(n+"."+c)),!isNaN(r)&&0<r){var l=r*this.config.rate,s=this.formatPrice(l),i=o.textContent,l=i.split(/[\d.,]+/)[0]||"",o=i.split(/[\d.,]+/)[1]||"";let e=s,t="";s.includes(a)&&([e,t]=s.split(a));i=`<span class="_product-details-meta">${l}${e}${a}<sup class="price-decimals">${t||"00"}</sup>${this.config.signRight}${o.replace(/^[^\d]+/,"")}</span>`;d+=i}}return e.innerHTML=d,e}processUnitElement(e){var t,r,n,c,i;e.innerHTML.includes("|")||(r=e.textContent.trim(),/лв\.?|BGN|€|EUR/i.test(r)&&(r=r.match(/([\d.,]+)\s*([а-яА-Яa-zA-Z.]+)\s*(\/\s*.+)?/))&&(n=window?.ccsettings?.currency?.dec_point||",",n=parseFloat(r[1].replace(n,".").replace(/\s/g,"")),isNaN(n)||(t=r[2]||"",r=r[3]?r[3].trim():"",c=n*this.config.rate,n=this.formatPrice(n),c=this.formatPrice(c),i=this.config.signLeft.trim()||"€",e.innerHTML=n+`  ${t}  ${r} | ${c}  ${i}  `+r)))}removeOldSecondaryElements(e){let t=e.nextSibling;for(var r=[];t;)1===t.nodeType&&t.classList.contains(this.config.selectors.secondary.slice(1))&&r.push(t),t=t.nextSibling;r.forEach(e=>e.remove())}processPriceElement(d){if(!this.hasSecondaryPrice(d)){var l=this.parsePrice(d)["price"];if(!isNaN(l)){l=l*this.config.rate,l=this.createSecondaryElement(d,l),l=(d.parentNode.appendChild(l),d.querySelector("._product-details-meta"));if(l){let r="",n="",c="",i="",s=!1,o=!1,e=(l.childNodes.forEach(e=>{var t;e.nodeType!==Node.TEXT_NODE||s?e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("price-decimals")&&!o?(n=e.textContent.replace(/\D/g,"")||"00",o=!0):o&&e.nodeType===Node.TEXT_NODE&&(c+=e.textContent):(t=e.textContent.match(/([\d.,]+)/))?(i=e.textContent.split(t[1])[0],r=t[1].replace(",","."),c=e.textContent.split(t[1])[1]||"",s=!0):i+=e.textContent}),r=r||"0",n=n||"00",parseFloat(r+"."+n));var p=(e=isNaN(e)?0:e)*this.config.rate,p=this.formatPrice(p),u=window?.ccsettings?.currency?.dec_point||",";let t=p,a="";p.includes(u)&&([t,a]=p.split(u)),c=c.replace(/\s*(лв\.|лв|BGN|€|EUR)\.?/gi,"").replace(/\s{2,}/g," ");p=`<span class="_product-details-meta"${l.getAttribute("style")?` style="${l.getAttribute("style")}"`:""}>${i}${t}${u}<sup class="price-decimals">${a||"00"}</sup> ${this.config.signRight}${c}</span>`,l=d.parentNode.querySelector(".bgn2eur-secondary-currency");l&&(l.innerHTML+=p)}}}}setTooltips(){var e=$(this.config.selectors.secondary);0!==e.length&&window.CCAppsConfig?.bgn2eur?.message&&(e.attr("data-original-title",window.CCAppsConfig.bgn2eur.message),e.each(function(){var e=$(this),t=0<e.closest("._product-details-sticky").length?"bottom":"auto";e.tooltip({placement:t})}))}processAll(){(document.querySelector(this.config.selectors.primary)||document.querySelector(this.config.selectors.unitElements))&&(document.querySelectorAll(this.config.selectors.unitElements).forEach(e=>this.processUnitElement(e)),document.querySelectorAll(this.config.selectors.priceElements.join(",")).forEach(e=>{this.removeOldSecondaryElements(e),this.processPriceElement(e)}),this.setTooltips())}clearCache(){this.cache.clear()}installCss(){var e=document.createElement("style");e.textContent=this.cssTemplate(),document.head.appendChild(e)}cssTemplate(){return`.bgn2eur-secondary-currency,
        .bgn2eur-primary-currency {
            white-space: nowrap;
        }
        .bgn2eur-primary-currency:after {
            content: '/';
            padding-inline: 0.5ch;
        }
        ._product-details-price-new,
        ._product-details-price ._product-details-price-bar > span,
        ._product-details-price-old ._product-details-price-value,
        ._product-details-price-saved ._product-details-price-value,
        ._list-one ._product ._product-price .price,
        ._product ._product-price .price,
        ._list-one ._product ._product-price-compare,
        ._product ._product-price-compare,
        ._list-one ._product ._product-price-old,
        ._product ._product-price-old,
        ._product-price .price,
        ._bundle-list-item-price-new,
        ._bundle-list-price-new-value,
        ._cart-compact-products-subtotal-num,
        ._cart-compact-products-list-item-price,
        ._product-details-sticky-info ._product-details-price-new,
        .cc-crosssell-item-price-new,
        .cc-crosssell-item-price-old>i,
        ._product-details-actions ._product-details-price ._product-details-price-bar > span._product-details-price-new {
            display: inline-flex;
            flex-wrap: wrap;
        }
        ._product-price-diff {
            margin-right: 0.5ch;
        }
        @media (max-width: 479px) {
            ._cart-product-total-price {
                position: static;
                right: auto;
                bottom: auto;
                margin-top: 16px;
            }
        }`+this.extendedCssTemplate()}extendedCssTemplate(){var e=document.querySelector('meta[name="designer"]')?.content||null;return e&&(["knowledge-freedom","knowledge","summer"].includes(e)||-1<String(e).indexOf("motivation"))?`._list-one ._product-price-compare,
        ._product-price-compare {
            display: inline-block;
            margin-right: 0;
        }

        ._product-sidebar {
            ._product-details-price {
                width: 100%;
            }
            ._product-details-price-new {
                display: inline-flex;
                flex-wrap: wrap;
                margin-right: 0;
            }
            ._product-details-stock-status-bar {
                display: table;
            }
        }

        @media (max-width: 767px) and (min-width: 480px) {
            ._cart-product-quantity {
                position: relative;
            }
            ._cart-product-total-price {
                position: relative;
                left: 165px;
                margin-top: 16px;
            }
        }`:""}}const currencyConverter=new Bgn2EurCurrencyConverter,setSecondaryCurrency=()=>{currencyConverter.processAll(),formatSelectedValues()},setSecondaryCurrencyTooltip=($(document).trigger("bgn2eur:ready"),()=>currencyConverter.setTooltips());function formatDropdownOptions(){document.querySelectorAll(".select2-results .select2-result-label").forEach(e=>{var t,r,n,c,i,s,o,a;!e.innerHTML.includes("лв.")&&!e.innerHTML.includes("BGN")||e.querySelector(".bgn2eur-primary-currency")||(t=e.textContent,/\d+[.,]\d+\s*(лв\.?|BGN)\d+[.,]\d+\s*€/.test(t)?(i=/(\d+[.,]\d+)\s*(лв\.?|BGN)(\d+[.,]\d+)\s*€/i.exec(t))&&(n=i[1],a=i[2],i=i[3],r=t.indexOf(n),c=t.indexOf(a)+a.length,s=t.indexOf(i),o=t.indexOf("€")+1,r=t.substring(0,r),c=t.substring(c,s),s=t.substring(o),e.innerHTML=r+`<span class="bgn2eur-primary-currency">${n} ${a}</span>${c}<span class="bgn2eur-secondary-currency">${i} €</span>`+s):(o=/(\d+[.,]\d+)\s*(лв\.?|BGN)/gi.exec(t))&&(r=o[1],n=o[2],a=(parseFloat(r.replace(",","."))*currencyConverter.config.rate).toFixed(2),c=currencyConverter.formatPrice(a),i=t.substring(0,t.indexOf(r)),s=t.substring(t.indexOf(r)+r.length+n.length),o=currencyConverter.config.signLeft,a=currencyConverter.config.signRight,e.innerHTML=i+`<span class="bgn2eur-primary-currency">${r} ${n}</span><span class="bgn2eur-secondary-currency">${o}${c}${a}</span>`+s))})}function formatSelectedValues(){document.querySelectorAll("._parameter-select ._select._parameter-value .select2-chosen").forEach(e=>{var t,r,n,c,i,s,o,a;!e.innerHTML.includes("лв.")&&!e.innerHTML.includes("BGN")||e.querySelector(".bgn2eur-primary-currency")||(t=e.textContent,/\d+[.,]\d+\s*(лв\.?|BGN)\d+[.,]\d+\s*€/.test(t)?(i=/(\d+[.,]\d+)\s*(лв\.?|BGN)(\d+[.,]\d+)\s*€/i.exec(t))&&(n=i[1],a=i[2],i=i[3],r=t.indexOf(n),c=t.indexOf(a)+a.length,s=t.indexOf(i),o=t.indexOf("€")+1,r=t.substring(0,r),c=t.substring(c,s),s=t.substring(o),e.innerHTML=r+`<span class="bgn2eur-primary-currency">${n} ${a}</span>${c}<span class="bgn2eur-secondary-currency">${i} €</span>`+s):(o=/(\d+[.,]\d+)\s*(лв\.?|BGN)/gi.exec(t))&&(r=o[1],n=o[2],a=(parseFloat(r.replace(",","."))*currencyConverter.config.rate).toFixed(2),c=currencyConverter.formatPrice(a),i=t.substring(0,t.indexOf(r)),s=t.substring(t.indexOf(r)+r.length+n.length),o=currencyConverter.config.signLeft,a=currencyConverter.config.signRight,e.innerHTML=i+`<span class="bgn2eur-primary-currency">${r} ${n}</span><span class="bgn2eur-secondary-currency">${o}${c}${a}</span>`+s))})}$(document).on("show.bs.modal",function(e){0<$(e.target).find(".product-details").length&&setTimeout(setSecondaryCurrency,100)}),$(function(){setSecondaryCurrencyTooltip(".bgn2eur-secondary-currency")}),$(document).on("cc.category-properties.after ajaxSuccess",function(){setSecondaryCurrencyTooltip(".bgn2eur-secondary-currency")}),$(document).on("select2-open",function(){setTimeout(()=>{formatDropdownOptions()})}),$(document).on("change","._parameter-select ._select._parameter-value",function(){setTimeout(()=>{formatSelectedValues()})}),5.7!==window.APP_VERSION&&CCEvents.ready(()=>{"zora-new"===(document.querySelector('meta[name="designer"]')?.content||null)&&$(window).on("load",function(){setTimeout(setSecondaryCurrency,500)})});